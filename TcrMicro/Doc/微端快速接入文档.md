# 快速接入版

快速接入版直接静默下载完整apk来完成微端包到热更包的转化。

## 接入流程

**准备工作：**

1、将游戏包给到对接群的工作人员，工作人员会把游戏部署到腾讯云后台服务器，然后返回GameID。

2、将游戏apk上传到服务器并生成下载链接。
第一步，下载[微端包示例工程](../Demo/微端APP示例工程/TcrMicroAppForUnity2018Empty.zip)，使用AndroidStudio打开。

第二步，修改构建脚本。
打开app模块下的build.gradle文件，修改applicationId、minSdkVersion、targetSdkVersion与您的游戏工程一致，versionCode要小于游戏包的versionCode。

```groovy
defaultConfig {
        // 应用名称和您的游戏包名一致
        applicationId "com.DefaultCompany.Unity2018Empty"
        // 与你的游戏版本保持一致
        minSdkVersion 21 // 微端SDK最低支持到16
        //noinspection ExpiredTargetSdkVersion,OldTargetApi
        targetSdkVersion 29 // 与你的游戏版本保持一致
        versionCode rootProject.ext.versionCode
        versionName rootProject.ext.versionName
        ...
}
```

修改签名文件与您的游戏工程一致。

```groovy
signingConfigs {
        release {
            keyAlias "testres"
            keyPassword "testres"
            storePassword "testres"
            storeFile file("keystore/micro.keystore")
        }
    }
```

以上两步保证安装之后的apk会把微端apk替换掉。

第三步，修改工程配置。

打开工程assets下的microSettings.xml，修改对应参数

```xml
<?xml version="1.0" encoding="utf-8"?>
<settings>
    <!--    游戏ID-->
    <setting key="game_id" value="game-xxxxx" />
    <!--    patch存放的位置，不进行配置将使用apk安装的方式-->
    <setting key="patch_url" value="" />
    <!--    apk安装-->
    <setting key="apk_url" value="https://cg-sdk-1258344699.cos.ap-nanjing.myqcloud.com/micro/patch/TcrMicroAppForUnity2018Empty/xxx.apk" />
    <!--    与云端通信的端口号，无登录/支付穿透功能不需要修改-->
    <setting key="port" value="6666" />
    <!--    下载速度，分为三档，根据当前云游戏的运行情况自动调节-->
    <setting key="download_speed_low" value="256" />
    <setting key="download_speed_middle" value="512" />
    <setting key="download_speed_high" value="1024" />

    <!--    需要hook的so列表，value中写"libtest1.so,libtest2.so"，多个so之前用逗号隔开-->
    <setting key="hook_so_list" value="libunity.so" />
</settings>
```

将部署之后生成的游戏ID填入到game_id中，

将apk的下载链接填入到apk_url中。

第四步，打开app目录下的tinker-support.gradle文件，将tinkerSupport中的enable置为false。

第五步，打开AndroidManifest.xml，在Application标签下新增如下内容：

```xml
<!--可选，如果采用了热更新快速接入，请新增该provider -->
<provider
    android:name="androidx.core.content.FileProvider"
    android:authorities="${applicationId}.provider"
    android:exported="false"
    android:grantUriPermissions="true">
    <meta-data
        android:name="android.support.FILE_PROVIDER_PATHS"
        android:resource="@xml/micro_filepaths" />
</provider>
```

以上步骤完成后，编译生成apk，运行验证即可。
