**云游戏虚拟按键SDK(安卓 Java)**

# 一、说明：
- 库文件：tcgui-gamepad.aar，虚拟按键拓展库<br>
- 支持按键类型：
    - 按键(78个单击按键)；
    - 鼠标按键(左、中、右、上滚、下滚)；
    - 十字摇杆键(WDSA、上右下左)；
  - Xbox手柄A、B、X、Y、Select、Start、LB、RB、L3、R3普通点击键；(V1.1)
  - Xbox手柄延时板机键：LT、RT (V1.1)
    *点击时在短时间内连续发多次消息，消息的力度随时间逐增减。*
  - Xbox手柄左、右摇杆键；(V1.1)
  - Xbox手柄十字方向键(V1.1)
- 编辑功能：
  - 动态添加/删除按键；
  - 动态调整按键位置、大小；
  - 增加辅助线方便定位按键；(V1.1)
  - 点击类按键支持修改名称(最多显示6个字符)(V1.1)。<br>
 *注：UI切图等资源暂不支持动态设置*

# 二、使用说明：

## 1、关键类介绍
### a、GamepadManager
虚拟按键管理类(继承RelativeLayout)。<br>
注册*OnEditListener*监听虚拟按键编辑事件的回调。<br>
注册*IInstructionListener*监听触发按钮事件的回调。<br>

## 2、关键流程说明
### a、初始化
```java
mCustomGamePad = new GamepadManager(this);
mCustomGamePad.setEditListener();
mCustomGamePad.setInstructionListener();
// 视图应放在游戏视频视图之上
addView(mCustomGamePad);
```
### b、读取配置文件
```java
String mCustomGamePadCfg;
mCustomGamePadCfg = readConfigFile("default_gamepad.cfg");
```
*注：此处代码仅演示过程，具体文件的读写由业务层来实现*

### c、显示虚拟按键 或 编辑虚拟按键
```java
// 显示虚拟按键
mCustomGamePad.showGamepad(mCustomGamePadCfg);
// 进入编辑模式
mCustomGamePad.editGamepad(mCustomGamePadCfg);

```
### d、启用手柄类按键布局(V1.1新增)
- 1、使用布局前判断是否为手柄按键。*gamepad.needConnected*
- 2、使用虚拟手柄前需调用接口通知云端启用手柄。*SDK.sendGamePadConnected*
- 3、结束虚拟手柄后主动卸载云端手柄。*SDK.sendGamePadDisconnected*
```java
if (enable) {
  mCustomGamePad.setVisibility(View.VISIBLE);
  mCustomGamePad.showGamepad(mCustomGamePadCfg);
  // 判断是否为手柄按键
  if (mCustomGamePad.needConnected()) {
    // 需等SDK连接成功有画面之后再发送，可以监听接口的回调判断云端是否有成功接收。
    mSDK.sendGamePadConnected(com.tencent.tcgsdk.api.IRTCResult callback);
  }
} else {
  mCustomGamePad.setVisibility(View.GONE);
  if (mCustomGamePad.needConnected()) {
    mSDK.sendGamePadDisconnected();
  }
}
```

### e、监听编辑事件的回调
```java
mCustomGamePad.setEditListener((isChanged, jsonCfg) -> {
   if (isChanged) {
   // 保存编辑后的配置文件
       mCustomGamePadCfg = jsonCfg;
   }
}

```

### f、监听按键点击触发的事件
```java
mCustomGamePad.setInstructionListener(instruction -> {
    if (mSDK != null) {
      // 通过游戏SDK将指令发送出去
        mSDK.sendKmEvents(instruction);
    }
});

```

### g、适配与 虚拟鼠标 共存
```java

// 设置点击事件的代理，将事件传递给鼠标视图
public void setGamePadTouchDelegate(IGamepadTouchDelegate delegate) {
    mCustomGamePad.setGamePadTouchDelegate(delegate);
    
}

mControlView.setGamePadTouchDelegate((v, event) -> {
    mGameView.handleMotion(event);
    return true;
});

```

# 三、配置文件说明：
虚拟按键的配置信息以json的格式保存，由业务层管理文体的保存与读取。

# 四、忽略混淆：
打包时请设置混淆规则
1、对java代码不做混淆
```java
-keep class com.tencent.tcggamepad.**{*;}
```
2、对资源文件不做混淆
```java
tools:keep="@drawable/tcg_*"
```
