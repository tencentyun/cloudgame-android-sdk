# 事件回调概览

## TcrEvent 事件

下列事件通过TcrSessionObserver回调：
<table>
<tr>
<td rowspan="1" colSpan="1" >事件名称</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[STATE_INITED]()</td>

<td rowspan="1" colSpan="1" >表示会话已初始化。关联数据为NSString (client Session)</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[STATE_CONNECTED]()</td>

<td rowspan="1" colSpan="1" >表示会话已连接。无关联数据</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[STATE_RECONNECTING]()</td>

<td rowspan="1" colSpan="1" >表示会话正在重连。无关联数据</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[STATE_CLOSED]()</td>

<td rowspan="1" colSpan="1" >表示会话已关闭，无法再使用。关联数据为Integer类型，具体值范围参考TcrCode#SessionStopBaseCode</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CLIENT_STATS]()</td>

<td rowspan="1" colSpan="1" >表示性能数据已更新。关联数据为NSDictionary类型</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[MIC_STATUS_CHANGED]()</td>

<td rowspan="1" colSpan="1" >表示服务器的麦克风状态已改变。关联数据为NSDictionary类型，表示是否需要开启麦克风</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CAMERA_STATUS_CHANGED]()</td>

<td rowspan="1" colSpan="1" >表示服务器的摄像头状态已改变。关联数据为NSDictionary类型，包含分辨率宽度、高度和摄像头状态</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[IME_TYPE]()</td>

<td rowspan="1" colSpan="1" >表示连接到云设备时分配的输入法类型。关联数据为NSDictionary类型，包含服务器端的IME状态</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[INPUT_STATUS_CHANGED]()</td>

<td rowspan="1" colSpan="1" >表示服务器的输入状态已改变。关联数据为NSDictionary类型，包含状态信息</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[SCREEN_CONFIG_CHANGE]()</td>

<td rowspan="1" colSpan="1" >表示云手机屏幕配置已改变。关联数据为NSDictionary类型，包含屏幕方向、角度等信息</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[VIDEO_STREAM_CONFIG_CHANGED]()</td>

<td rowspan="1" colSpan="1" >表示云手机视频流配置已更新。关联数据为NSDictionary类型，包含屏幕宽度、高度等信息</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CLIENT_IDLE]()</td>

<td rowspan="1" colSpan="1" >表示用户处于空闲状态。无关联数据</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CLIENT_LOW_FPS]()</td>

<td rowspan="1" colSpan="1" >表示帧率连续10秒保持低水平。无关联数据</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[INPUT_STATE_CHANGE]()</td>

<td rowspan="1" colSpan="1" >表示远程输入框状态已改变。关联数据为NSDictionary类型，包含输入框类型、文本内容等信息</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CAI_TRANS_MESSAGE]()</td>

<td rowspan="1" colSpan="1" >云端应用向客户端发送的透传消息事件。关联数据为NSDictionary类型，包含包名和消息内容</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CAI_SYSTEM_USAGE]()</td>

<td rowspan="1" colSpan="1" >云端应用向客户端发送的负载信息。关联数据为NSDictionary类型，包含CPU、内存和GPU使用率</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CAI_CLIPBOARD]()</td>

<td rowspan="1" colSpan="1" >云端剪贴板内容同步事件。关联数据为NSDictionary类型，包含剪贴板文本内容</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CAI_NOTIFICATION]()</td>

<td rowspan="1" colSpan="1" >云端通知消息下发事件。关联数据为NSDictionary类型，包含应用包名、通知标题和正文</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CAI_IMAGE_EVENT]()</td>

<td rowspan="1" colSpan="1" >定期回调云端实例的画面截图。关联数据为NSDictionary类型，包含实例ID和截图URL</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >[CAI_SYSTEM_STATUS]()</td>

<td rowspan="1" colSpan="1" >每1秒云端应用通过webrtc向客户端发送的系统状态。关联数据为NSDictionary类型，包含导航栏可见性和媒体音量</td>
</tr>
</table>


# 事件详细说明

## 初始化成功事件

当SDK初始化成功时触发STATE_INITED事件。

#### 返回值

`NSString*`: 客户端会话标识符。

#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == STATE_INITED) {
        NSString *clientSession = (NSString *)eventData;
        // 处理初始化成功事件，使用clientSession初始化TcrSession
    }
}
```



## 会话连接事件

当会话成功连接时触发STATE_CONNECTED事件。

#### 返回值

无。

#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == STATE_CONNECTED) {
        // 处理会话连接事件，例如更新UI状态
    }
}
```



## 会话重连中事件

当会话正在重连时触发STATE_RECONNECTING事件，可用于提示用户。

#### 返回值

无。

#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == STATE_RECONNECTING) {
        // 处理重连中事件，例如显示加载提示
    }
}
```



## 会话关闭事件

当会话关闭且无法再使用时触发STATE_CLOSED事件。

#### 返回值

`NSInteger`: 关闭代码，值范围参考TcrCode#SessionStopBaseCode。

#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == STATE_CLOSED) {
        NSInteger closeCode = [(NSNumber *)eventData integerValue];
        // 处理会话关闭事件，例如记录错误码
    }
}
```



## 性能数据更新事件

当客户端性能数据更新时触发CLIENT_STATS事件。

#### 返回值

`NSDictionary`: 性能数据字典。

#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CLIENT_STATS) {
        NSDictionary *stats = eventData;
        // 处理性能数据事件，例如分析性能指标
    }
}
```



## 服务器麦克风状态改变事件

当服务器麦克风状态（如打开或关闭）改变时触发MIC_STATUS_CHANGED事件。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >status</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >麦克风状态：`open`（打开）、`close`（关闭）。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == MIC_STATUS_CHANGED) {
        NSDictionary *micStatus = eventData;
        // 处理麦克风状态事件，例如打开/关闭音频上行
    }
}
```



## 服务器摄像头状态改变事件

当服务器摄像头状态（如打开或关闭）改变时触发CAMERA_STATUS_CHANGED事件。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >width</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >摄像头分辨率宽度。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >height</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >摄像头分辨率高度。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >status</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >摄像头状态：`open_back`（打开后置摄像头）、`open_front`（打开前置摄像头）、`close`（关闭）。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CAMERA_STATUS_CHANGED) {
        NSDictionary *cameraStatus = eventData;
        // 处理摄像头状态事件，例如打开/关闭视频上行
    }
}
```



## 输入法类型事件

当连接到云设备时，输入法类型（云端或客户端本地）确定时触发IME_TYPE事件。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >ime_type</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >输入法类型：`cloud`（使用云端输入法）、`local`（使用客户端本地输入法）。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == IME_TYPE) {
        NSDictionary *imeInfo = eventData;
        // 处理输入法类型事件，例如切换输入法UI
    }
}
```



## 输入状态改变事件

当服务器输入状态改变时触发INPUT_STATUS_CHANGED事件。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >status</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >输入状态：`disabled`（输入被禁用）。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == INPUT_STATUS_CHANGED) {
        NSDictionary *inputStatus = eventData;
        // 处理输入状态事件，例如禁用用户输入控件
    }
}
```





## 云手机屏幕配置改变事件

当云手机屏幕配置（如方向或尺寸）改变时触发SCREEN_CONFIG_CHANGE事件。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >orientation</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >屏幕方向：`landscape`（横屏）、`portrait`（竖屏）。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >degree</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >旋转角度：`0_degree`、`90_degree`、`180_degree`、`270_degree`。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >width</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >屏幕宽度。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >height</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >屏幕高度。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == SCREEN_CONFIG_CHANGE) {
        NSDictionary *screenConfig = eventData;
        // 处理屏幕配置事件，例如调整渲染尺寸
    }
}
```



## 云手机视频流配置改变事件

当云手机视频流配置（如分辨率）更新时触发VIDEO_STREAM_CONFIG_CHANGED事件。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >width</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >视频流宽度。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >height</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >视频流高度。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == VIDEO_STREAM_CONFIG_CHANGED) {
        NSDictionary *videoConfig = eventData;
        // 处理视频流配置事件，例如更新解码器
    }
}
```



## 客户端空闲事件

当用户长时间未操作鼠标、键盘或屏幕时触发CLIENT_IDLE事件。

#### 返回值

无关联数据。

#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CLIENT_IDLE) {
        // 处理空闲事件，例如显示节能提示
    }
}
```



## 客户端低帧率事件

当帧率连续10秒保持低位时触发CLIENT_LOW_FPS事件。

#### 返回值

无关联数据。

#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CLIENT_LOW_FPS) {
        // 处理低帧率事件，例如优化渲染性能
    }
}
```



## 云端输入框状态改变事件

当云端输入框状态（如焦点）改变时触发INPUT_STATE_CHANGE事件。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >field_type</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >输入框类型：`normal_input`（常规窗口焦点）、`autologin_input`（已弃用）、`unfocused`（焦点移出窗口）。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >text</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >输入框文本内容（仅Android应用支持）。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >status</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >输入状态（仅Windows系统）：`disable`（禁用输入）、`enable`（启用输入）。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >input_type</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >文本内容类型位定义（整数）。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == INPUT_STATE_CHANGE) {
        NSDictionary *inputState = eventData;
        // 处理输入框状态事件，例如同步文本内容
    }
}
```



## 云端透传消息事件

当云端应用向客户端发送透传消息时触发CAI_TRANS_MESSAGE事件。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >package_name</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >目标应用的包名（Android应用标识）。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >msg</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >透传的原始消息内容（字符串或JSON对象）。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CAI_TRANS_MESSAGE) {
        NSDictionary *transMessage = eventData;
        // 处理透传消息事件
    }
}
```



## 云端系统负载信息事件

当云端应用向客户端发送系统负载信息（如CPU、内存、GPU使用率）时触发CAI_SYSTEM_USAGE事件。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >cpu_usage</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >CPU使用率（百分比，浮点数）。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >mem_usage</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >内存使用率（百分比，浮点数）。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >gpu_usage</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >GPU使用率（百分比，浮点数）。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CAI_SYSTEM_USAGE) {
        NSDictionary *systemUsage = eventData;
        // 处理系统负载信息事件
    }
}
```



## 云端剪贴板同步事件

当云端设备的剪贴板内容发生变化时触发CAI_CLIPBOARD事件，将最新文本同步至客户端。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >text</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >剪贴板的最新文本内容。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CAI_CLIPBOARD) {
        NSDictionary *clipboardData = eventData;
        NSString *text = clipboardData[@"text"];
        // 处理剪贴板同步事件
    }
}
```



## 云端通知消息事件

当云机上有新通知时，触发CAI_NOTIFICATION事件将通知消息下发至客户端。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >package_name</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >发送通知的应用包名。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >title</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >通知标题。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >text</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >通知正文。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CAI_NOTIFICATION) {
        NSDictionary *notification = eventData;
        // 处理通知消息事件
    }
}
```



## 云端画面截图事件

CAI_IMAGE_EVENT事件定期回调云端实例的画面截图URL。

#### 返回值

`NSDictionary`: 键为实例ID（NSString），值为截图URL（NSString）。
<table>
<tr>
<td rowspan="1" colSpan="1" >键（实例ID）</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >instanceId1</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >实例1的截图URL</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >instanceId2</td>

<td rowspan="1" colSpan="1" >NSString</td>

<td rowspan="1" colSpan="1" >实例2的截图URL</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >...</td>

<td rowspan="1" colSpan="1" >...</td>

<td rowspan="1" colSpan="1" >...</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CAI_IMAGE_EVENT) {
        NSDictionary *imageEvents = eventData;
        // 遍历处理每个实例的截图URL
        [imageEvents enumerateKeysAndObjectsUsingBlock:^(NSString *instanceId, NSString *screenshotUrl, BOOL *stop) {
            // 处理截图URL
        }];
    }
}
```



## 云端系统状态事件

CAI_SYSTEM_STATUS事件回调云端应用每1秒通过WebRTC向客户端发送的系统状态信息。

#### 返回值

`NSDictionary`: 
<table>
<tr>
<td rowspan="1" colSpan="1" >键</td>

<td rowspan="1" colSpan="1" >值类型</td>

<td rowspan="1" colSpan="1" >描述</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >nav_visible</td>

<td rowspan="1" colSpan="1" >NSNumber (BOOL)</td>

<td rowspan="1" colSpan="1" >导航栏是否可见。</td>
</tr>

<tr>
<td rowspan="1" colSpan="1" >music_volume</td>

<td rowspan="1" colSpan="1" >NSNumber</td>

<td rowspan="1" colSpan="1" >系统媒体音量（范围0-100）。</td>
</tr>
</table>


#### 监听示例
``` objective-c
- (void)onEvent:(TcrEvent)eventType eventData:(id _Nullable)eventData {
    if (eventType == CAI_SYSTEM_STATUS) {
        NSDictionary *systemStatus = eventData;
        BOOL navVisible = [systemStatus[@"nav_visible"] boolValue];
        NSInteger musicVolume = [systemStatus[@"music_volume"] integerValue];
        // 处理系统状态事件
    }
}
```

